<!DOCTYPE html>
<html>
<head>
  <title>Your Top Tracks</title>
  <style>
    .track-list {
      display: flex;
      flex-direction: column;
      gap: 20px;
      margin-top: 30px;
    }

    .track-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid #ccc;
      padding-bottom: 10px;
    }

    .track-left {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .track-item img {
      width: 80px;
      height: 80px;
      border-radius: 8px;
    }

    .track-info {
      display: flex;
      flex-direction: column;
    }

    .track-name {
      font-weight: bold;
    }

    .track-artist {
      color: gray;
    }

    .audio-preview {
      min-width: 200px;
      text-align: right;
    }

    .spotify-link {
      font-size: 0.9em;
      color: #1DB954;
      text-decoration: none;
    }

    .no-preview {
      color: red;
      font-size: 0.9em;
    }
  </style>
</head>
<body>
  {% set label_map = {
    'short_term': 'Past 4 Weeks',
    'medium_term': 'Past 6 Months',
    'long_term': 'All Time'
  } %}
  <h1>Your Top Tracks ({{ label_map.get(time_range or 'medium_term') }})</h1>

  {% if session.solo_mode %}
    <p>Youâ€™re in <strong>solo mode</strong>. This playlist will be created in your account only.</p>

    <form action="/top-tracks" method="post">
      <label for="time_range">Choose time range:</label>
      <select name="time_range" id="time_range">
        <option value="short_term" {% if time_range == "short_term" %}selected{% endif %}>Past 4 Weeks</option>
        <option value="medium_term" {% if time_range == "medium_term" %}selected{% endif %}>Past 6 Months</option>
        <option value="long_term" {% if time_range == "long_term" %}selected{% endif %}>All Time</option>
      </select>

      <br><br>

      <label for="track_limit">How many tracks (1â€“50):</label>
      <input type="number" id="track_limit" name="track_limit" min="1" max="50" value="{{ track_limit or 20 }}">

      <br><br>

      <button type="submit">Refresh Tracks</button>
    </form>
  {% endif %}

  <!-- ðŸ”¥ Track Display Section -->
  <div class="track-list">
    {% for track in track_info %}
      <div class="track-item">
        <!-- Left side: album cover + info -->
        <div class="track-left">
          <img src="{{ track.image }}" alt="Album cover">
          <div class="track-info">
            <div class="track-name">{{ track.name }}</div>
            <div class="track-artist">{{ track.artist }}</div>
          </div>
        </div>

        <!-- Right side: preview audio or link -->
        <div class="audio-preview">
          {% if track.preview_url %}
            <audio controls style="width: 180px;">
              <source src="{{ track.preview_url }}" type="audio/mpeg">
              Your browser does not support the audio element.
            </audio>
          {% else %}
            <div class="no-preview">No preview</div>
          {% endif %}
          <br>
          <a class="spotify-link" href="https://open.spotify.com/track/{{ track.uri.s
